<!DOCTYPE html>
<html lang="en">

<!--- Page title --->

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="../CSS file/Result_Product-edit.css">
    <title>Game Sole|Console online shop|</title>
</head>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var value = getCookie("GameSoletoken");
        $.ajax({
            url: '/cookie',
            type: 'POST',
            data: { cookie: value },
            datatype: 'json',
            success: function (data) {
                var obj = JSON.parse(data);
                if (obj.role == "Administator") {
                    $('.Register-navbar').hide();
                    $('.Login-navbar').hide();
                    $('.User-edit').show();
                    $('.Product-edit').show();
                    $('.Logout-navbar').show();
                    document.getElementById("User-email").innerHTML = "<p>" + "Admin: " + obj.email + "</p>";
                } else {
                    document.location.href = '/Homepage.html';
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                document.location.href = '/Homepage.html';
            }
        });

        $('.Logout-navbar').click(function () {
            document.cookie = "GameSoletoken" + '=; Max-Age=-99999999;';
            location.reload();
        });
    });
    function getCookie(name) {
        let cookie = {};
        document.cookie.split(';').forEach(function (el) {
            let [k, v] = el.split('=');
            cookie[k.trim()] = v;
        })
        return cookie[name];
    }
</script>

<body>
    <header>
        <!--- Contain Web logo, login, and register button link to another page --->
        <div class="Logo-navbar">

            <!--- Web logo link to homepage --->
            <nav class="Homepage-navbar">
                <a href="Homepage.html"><img src="../images/Logo_Rev2.png" /></a>
            </nav>

            <!--- Register logo link to register page--->
            <nav class="Register-navbar">
                <a href="Register.html"><img src="../images/2U Button Yellow Register Idle.png" / alt="back"></a>
                <!--- another version of images to use 'Hover' in CSS -->
                <a href="Register.html"><img src="../images/2U Button Yellow Register.png" / class="img-top"
                        alt="front"></a>
            </nav>

            <!--- Login logo link to Login page--->
            <nav class="Login-navbar">
                <a href="Login.html"><img src="../images/2U Button Cream Idle.png" / alt="back"></a>
                <!--- another version of images to use 'Hover' in CSS -->
                <a href="Login.html"><img src="../images/2U Button Cream Press.png" / class="img-top" alt="front"></a>
            </nav>

            <!--- Logout logo to Logout--->
            <nav class="Logout-navbar">
                <a input type="image" name="Logout"><img src="../images/2U Button Red Logout Idle.png" / alt="back"></a>
                <!--- another version of images to use 'Hover' in CSS -->
                <a input type="image" name="Logout"><img src="../images/2U Button Red Logout Press.png" /
                        class="img-top" alt="front"></a>
            </nav>

            <!--- Email of the logged in user--->
            <nav class="User-email" id="User-email">
            </nav>
        </div>
    </header>

    <!---Navigation bar contain Homepage, ShopPage, and About US button link to another page --->
    <nav class="Menu-navbar">

        <!--- Homepage button link to Home page --->
        <nav class="Homepage">
            <a href="/Homepage.html"><img src="../images/Navigation Bar Home.png" /></a>
        </nav>

        <!--- Shopping button link to Shop page --->
        <nav class="Shopping">
            <a href="/ShopPage.html"><img src="../images/Navigation Bar Shop Idle.png" /></a>
        </nav>

        <!--- About Us button link to About US page --->
        <nav class="About US">
            <a href="/AboutUs.html"><img src="../images/Navigation Bar About Us Idle.png" /></a>
        </nav>

        <!--- User edit button link to admin edit User page --->
        <nav class="User-edit">
            <a href="/User-edit.html"><img src="../images/Navigation Bar User  Idle.png" /></a>
        </nav>

        <!--- Product edit button link to admin edit product page --->
        <nav class="Product-edit">
            <a href="/Product-edit.html"><img src="../images/Navigation Bar Product Press.png" /></a>
        </nav>
    </nav>

    <!--- Contain a searching option --->
    <div class="sidenav">
        <!--- Search Bar --->
        <input class="search_bar" style="width: 182px;" type="text" id="PROD_Name" name="PROD_Name"
            placeholder="Search.." pattern="[a-zA-Z0-9?~`!@#$%\^&*()\-_=+[\]{};:\x27.,\x22\\|/?><]+">
        <!--- Dropdown Criteria --->
        <button type="button" class="dropdown-btn">Video game/Game player/Controller
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-container">
            <label class="container">Video game<input type="radio" name="PROD_Type" value="Video game"><span
                    class="checkmark"></span></label>
            <label class="container">Game player<input type="radio" name="PROD_Type" value="Game player"><span
                    class="checkmark"></span></label>
            <label class="container">Controller<input type="radio" name="PROD_Type" value="Controller"><span
                    class="checkmark"></span></label>
        </div>
        <button type="button" class="dropdown-btn">Period generation
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-container">
            <label class="container">First generation<input type="radio" name="PROD_Period_generation"
                    value="First"><span class="checkmark"></span></label>
            <label class="container">Second generation<input type="radio" name="PROD_Period_generation"
                    value="Second"><span class="checkmark"></span></label>
            <label class="container">Third generation<input type="radio" name="PROD_Period_generation"
                    value="Third"><span class="checkmark"></span></label>
            <label class="container">Fourth generation<input type="radio" name="PROD_Period_generation"
                    value="Fourth"><span class="checkmark"></span></label>
            <label class="container">Fifth generation<input type="radio" name="PROD_Period_generation"
                    value="Fifth"><span class="checkmark"></span></label>
            <label class="container">Sixth generation<input type="radio" name="PROD_Period_generation"
                    value="Sixth"><span class="checkmark"></span></label>
            <label class="container">Seventh generation<input type="radio" name="PROD_Period_generation"
                    value="Seventh"><span class="checkmark"></span></label>
            <label class="container">Eighth generation<input type="radio" name="PROD_Period_generation"
                    value="Eighth"><span class="checkmark"></span></label>
            <label class="container">Ninth generation<input type="radio" name="PROD_Period_generation"
                    value="Ninth"><span class="checkmark"></span></label>
        </div>
        <button type="button" class="dropdown-btn">Console game player type
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-container">
            <label class="container">handheld console player<input type="radio" name="PROD_Console_type"
                    value="handheld console player"><span class="checkmark"></span></label>
            <label class="container">home console player<input type="radio" name="PROD_Console_type"
                    value="home console player"><span class="checkmark"></span></label>
        </div>
        <!--- Price Bar --->
        <input class="search_bar" style="width: 182px;  margin-top: 15px;" type="text" id="PROD_Price" name="PROD_Price"
            placeholder="Price.." pattern="[0-9?~`!@#$%\^&*()\-_=+[\]{};:\x27.,\x22\\|/?><]+">
        <!--- Submit Button --->
        <button class="search_bar" style="width: 190px;" value="submit" onclick="doSearch()">Search</button>
    </div>
    <!--- Contain a searching option --->

    <!--- Item Description --->
    <div class="main">
        <h2>Result for Product edit</h2>
        <div class="Product" id="result-box"></div>
        <fieldset class="update-delete">
            <h2 style="margin-left: 0;">Update/delete</h2>
            <label for="PROD_Name_edit">Name</label><br>
            <input type="text" name="PROD_Name_edit" id="PROD_Name_edit"><br>

            <label for="PROD_Price_edit">Price</label><br>
            <input type="text" name="PROD_Price_edit" id="PROD_Price_edit"><br>

            <label for="PROD_Description_edit">Description</label><br>
            <input type="text" name="PROD_Description_edit" id="PROD_Description_edit"><br>

            <label for="PROD_Image_edit">Image link</label><br>
            <input type="text" name="PROD_Image_edit" id="PROD_Image_edit"><br>

            <select style="height: 20px; margin-top: 20px;" for="PROD_Type_edit" name="PROD_Type_edit" id="PROD_Type_edit">
                <option value="Video game">Video game</option>
                <option value="Game player">Game player</option>
                <option value="Controller">Controller</option>
            </select>

            <select style="height: 20px; margin-top: 20px;" for="PROD_Period_generation_edit" name="PROD_Period_generation_edit"
                id="PROD_Period_generation_edit">
                <option value="First">First</option>
                <option value="Second">Second</option>
                <option value="Third">Third</option>
                <option value="Fourth">Fourth</option>
                <option value="Fifth">Game player</option>
                <option value="Sixth">Sixth</option>
                <option value="Seventh">Seventh</option>
                <option value="Eighth">Eighth</option>
                <option value="Ninth">Ninth</option>
            </select>

            <select style="height: 20px; margin-top: 20px;" for="PROD_Console_type_edit" name="PROD_Console_type_edit" id="PROD_Console_type_edit">
                <option value="home console player">home console player</option>
                <option value="handheld console player">handheld console player</option>
                <option value="NULL">NULL</option>
            </select><br>

            <button style="color: green; margin-top: 20px;" onclick="Product_update()">Update product</button>
            <button style="color: red;" onclick="Product_delete()">Delete product</button>
        </fieldset>

        <!--- Javascript function for Search the Product --->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                getData();
            });

            $('#edit-form').submit(function () {
                var pathArray = window.location.pathname.split('/');
                var PROD_ID = pathArray[-1];
                var form = document.getElementById("edit-form");
                var url = "/Result_Product-edit/" + String(PROD_ID);
                //form.action = url;
                console.log(url)
                return false;
            });

            function doSearch() {
                let PROD_Name = document.getElementById("PROD_Name").value;
                let PROD_Price = document.getElementById("PROD_Price").value;
                let PROD_Type = document.querySelector('input[name="PROD_Type"]:checked');
                let PROD_Period_generation = document.querySelector('input[name="PROD_Period_generation"]:checked');
                let PROD_Console_type = document.querySelector('input[name="PROD_Console_type"]:checked');
                if (PROD_Type != null) {
                    PROD_Type = PROD_Type.value;
                }
                if (PROD_Period_generation != null) {
                    PROD_Period_generation = PROD_Period_generation.value;
                }
                if (PROD_Console_type != null) {
                    PROD_Console_type = PROD_Console_type.value;
                }
                if (PROD_Name == "") {
                    PROD_Name = null;
                }
                if (PROD_Price == "") {
                    PROD_Price = null;
                }
                window.location = "/Product-edit.html?name=" + PROD_Name + "&"
                    + "price=" + PROD_Price + "&"
                    + "type=" + PROD_Type + "&"
                    + "gen=" + PROD_Period_generation + "&"
                    + "content-type=" + PROD_Console_type;
            }

            function getData() {
                let path = window.location.href;
                let productId = path.split("/").slice(-1)[0]
                console.log(productId);
                fetch("http://localhost:4301/product-edit-result", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: productId
                    })
                })
                    .then(response => response.json())
                    .then(data => setResult(data));
            }

            function setResult(data) {
                console.log(data)
                for (let n of data.data) {
                    output = "<a><article><figure><img src=" + n.PROD_Image + "><figcaption>" + n.PROD_Name + "</figcaption><br><figcaption>" + n.PROD_Price + " Baht</figcaption><br><figcaption>Console type : " + n.PROD_Console_type + "</figcaption><br><figcaption>Period generation : " + n.PROD_Period_generation + "</figcaption><br></figure><label for='Description'>" + n.PROD_Description + "</label></article></a>";
                }
                document.getElementById("result-box").innerHTML = output;
            }

            //For update
            function Product_update() {
                let PROD_Name_edit = document.getElementById("PROD_Name_edit");
                let PROD_Price_edit = document.getElementById("PROD_Price_edit");
                let PROD_Description_edit = document.getElementById("PROD_Description_edit");
                let PROD_Image_edit = document.getElementById("PROD_Image_edit");

                if (PROD_Name_edit != null) {
                    PROD_Name_edit = PROD_Name_edit.value;
                }

                if (PROD_Price_edit != null) {
                    PROD_Price_edit = PROD_Price_edit.value;
                }

                if (PROD_Description_edit != null) {
                    PROD_Description_edit = PROD_Description_edit.value;
                }

                if (PROD_Image_edit != null) {
                    PROD_Image_edit = PROD_Image_edit.value;
                }

                let PROD_Type_edit = document.getElementById("PROD_Type_edit");
                let PROD_Period_generation_edit = document.getElementById("PROD_Period_generation_edit");
                let PROD_Console_type_edit = document.getElementById("PROD_Console_type_edit");

                PROD_Type_edit = PROD_Type_edit.options[PROD_Period_generation_edit.selectedIndex].text;
                PROD_Period_generation_edit = PROD_Period_generation_edit.options[PROD_Period_generation_edit.selectedIndex].text;
                PROD_Console_type_edit = PROD_Console_type_edit.options[PROD_Console_type_edit.selectedIndex].text;

                var pathArray = window.location.pathname.split('/');
                var PROD_ID = pathArray[pathArray.length - 1];

                fetch("http://localhost:4301/Result_Product-edit/" + String(PROD_ID), {
                    method: "PUT",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        PROD_Name: PROD_Name_edit,
                        PROD_Price: PROD_Price_edit,
                        PROD_Description: PROD_Description_edit,
                        PROD_Image: PROD_Image_edit,
                        PROD_Type: PROD_Type_edit,
                        PROD_Period_generation: PROD_Period_generation_edit,
                        PROD_Console_type: PROD_Console_type_edit
                    })
                }).then(window.location.replace("http://localhost:4301/Product-edit.html"))
            }

            //this is for delete product
            function Product_delete() {
                var pathArray = window.location.pathname.split('/');
                var PROD_ID = pathArray[pathArray.length - 1];
                fetch("http://localhost:4301/Result_Product-delete/" + String(PROD_ID), {
                    method: "DELETE",
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(window.location.replace("http://localhost:4301/Product-edit.html"))
            }
        </script>
    </div>

    <!--- Javascript function for drop down button --->
    <script>
        // Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict
        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;

        for (i = 0; i < dropdown.length; i++) {
            dropdown[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }
    </script>

</body>

</html>